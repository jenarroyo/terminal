<!-- /**
* For the brave souls who get this far: You are the chosen ones,
* the valiant knights of programming who toil away, without rest,
* fixing our most awful code. To you, true saviors, kings of men,
* I say this: never gonna give you up, never gonna let you down,
* never gonna run around and desert you. Never gonna make you cry,
* never gonna say goodbye. Never gonna tell a lie and hurt you.

OS Project by Jen Arroyo And Jill Soria
October 2016
*/
 -->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>demo</title>
  <link href="style.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="jquery-1.10.2.js"></script>
</head>
<body>
  <div class='inner'>
    <!-- TOOLBARS -->
    <div class='toolbar'>
      <ul class='controls'>
        <li>
          <a href="#" class="active"></a>
        </li>
        <li>
          <a href="#" class=""></a>
        </li>
        <li>
          <a href="#" class=""></a>
        </li>
      </ul>
      <div class='title'>
        <!-- Name of user + Terminal -->
        <span class='title-console'> Jen's Terminal</span>
      </div>
    </div>
    <!-- END OF TOOLBARS -->
    <div class="wrapper">
          <!-- This is our screen, where commands and executed commands will be displayed -->
          <div class='' id='screen'></div>

    <div id="command">
      <!-- This is where we type /  input commands -->
      MyOS><input type="text" value="" id="command-line">
    </div>    
    </div>
  </div>


<!-- START OF SCRIPT, THIS IS WHERE THE MAGIC HAPPENS -->
<script>
  // Always focus on the commandline
  $(document).ready(function() {
    $("#command-line").focus();
  }); 

  $('#command-line').keypress(function(e){
      var keycode = (e.keyCode ? e.keyCode : e.which);
      //if enter is pressed
      if(keycode == '13'){
        var value = $(this).val();//value of text in commandline

        // Developer's notes :)
        // The .val() get the value from the input field
        // Keycode = 13 is enterbutton
        // Bind keypress event to textbox

        // Code references
        // $("#screen").text("MyOS>" + value); //display value to text screen
        // $("#screen").clone().appendTo("#screen").text("MyOS>" + value); //working using clone() - not advisable
        // $('#screen').append($('<div>').text("MyOS>" + value).prepend($('</div>'))); //working without clone() better because optimized
        // $('#screen').append($('<marquee direction="right">').text(value).prepend($('</marquee>'))); //working marquee command

        var command = '';
        var succeeding_string = '';
        var space_index = value.indexOf(" ");
        var file_directory = "file_directory";

        // get first word = command, and succeeding string
        // get the index of the first "space" after the first word which is our command
       if (space_index > 0)
        {
          command = value.substring(0, space_index);
          succeeding_string = value.slice(space_index + 1);
        }
        else
        {
          command = value;
        }         

        if (command == "")
        {
          $("#screen").append($('<div>').text("MyOS>").prepend($('</div>')));
        }
        else if (command == "say") 
        {
          say(value, succeeding_string);
        }
        else if (command == "marquee")
        {
          marquee(value, succeeding_string);   
        }
        else if (command == "cls")
        {
          clear_screen();
        }
        else if (command == "help")
        {
          help(value);
        }
        else if (command == "ls")
        {
          ls(succeeding_string);
        }
        else
        {
          invalid(value);
        }; 

        $(this).val(''); //clear textbox
      }

      e.stopPropagation();
      //Stop the event from propogation to other handlers
      //If this line will be removed, then keypress event handler attached at document level will also be triggered

  });

  function clear_screen() {
    // cls = clear entire screen
    $('#screen').empty();
  }

  function say(value, succeeding_string) {
    // say <string with spaces> = display the string in a new line
    $('#screen').append($('<div>').text("MyOS>" + value).append($('</div><br/><div>' + succeeding_string + '</div>')));
  }

  function marquee(value, succeeding_string) {
    // marquee <string with spaces> = display a scrolling string that will move from left to right. 
    // you must still be able to enter commands in the terminal.
    // multiple marquee running at the same time is allowed
    $('#screen').append($('<div>').text("MyOS>" + value).append($('</div><br/><marquee direction="right">' + succeeding_string + '</marquee>')));   
  }

  function help(value) {
    $('#screen').append($('<div>').text("MyOS>" + value).append($('</div><br/><div>').html("Here are the list of valid commands you can use. <br/></br> cls &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -clear the entire screen. <br/> say &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -display the string in a new line. <br/> marquee &nbsp; -display scrolling string that will move from right to left.")));
  }

  function invalid(value) {
    $('#screen').append($('<div>').text("MyOS>" + value).append($('</div><br/><div>invalid or unrecognizable command "' + value + '"</div>')));
  }

  function ls(directory){

        /*** 
         * @TODO: If calling ls inside a subdirectory, need to determine current directory
         * Save current directory when doing a cd (change directory)
         *
         * @TODO ls with parameters ex. ls -l
         * Restriction, current code does not accept multiple params as of yet...ata..
         *
         * @TODO: When creating a file. make sure to change permissions to 777
         ***/

    console.log("directory: " + directory);

    //Ajax call to get list of file of current directory from server-side
    $.ajax({
      type: 'POST',
      url: '/mp/ls.php',
      //dataType: "html",
      dataType: "json",
      data: {"directory": directory},
      success: function(result) {
        $('#screen').append('<div> MyOS>ls ' + directory + '</div>');
        //$('#screen').append("<pre>" + result + "</pre><br/>");

        //print headers
        var html = "<div style='clear:both'>" +
            "<div style='float:left;width:150px'>Name</div>" +
            // "<div style='float:left;width:150px'>Owner</div>" +
            "<div style='float:left;width:80px'>Size</div>" +
            "<div style='float:left;width:200px'>Created</div>" +
            "<div style='float:left;width:200px'>Modified</div>" +
            "<br /></div>";
        $('#screen').append(html);

        //print file content
        jQuery.each(result, function(index, file) {
          html = "<div style='clear:both'>" +
            "<div style='float:left;width:150px'>" + file.name + "</div>" +
            // "<div style='float:left;width:150px'>" + file.owner + "</div>" +
            "<div style='float:left;width:80px'>" + file.size + "</div>" +
            "<div style='float:left;width:200px'>" + file.created + "</div>" +
            "<div style='float:left;width:200px'>" + file.modified + "</div>" +
            "<br /></div>";
          $('#screen').append(html);
        });
      }
    });
  }


</script>
 
</body>
</html>